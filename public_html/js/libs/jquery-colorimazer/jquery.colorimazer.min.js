(function(c){var a=(function(){var e=(function(){var i=function(u,B,z){var l,w,y,o,x,n,m,A;if(B===0){l=w=y=z}else{u/=60;o=Math.floor(u);x=u-o;n=z*(1-B);m=z*(1-B*x);A=z*(1-B*(1-x));switch(o){case 0:l=z;w=A;y=n;break;case 1:l=m;w=z;y=n;break;case 2:l=n;w=z;y=A;break;case 3:l=n;w=m;y=z;break;case 4:l=A;w=n;y=z;break;default:l=z;w=n;y=m}}return{r:Math.round(l*255),g:Math.round(w*255),b:Math.round(y*255)}};var j=function(l,o,p){var m=Math.min(l,o,p);var q=Math.max(l,o,p);var u=q/255;var w=0;var n=-1;var t=q-m;if(q!==0){w=t/q;if(l===q){n=(o-p)/t}else{if(o===q){n=2+(p-l)/t}else{n=4+(l-o)/t}}}n*=60;while(n<0){n+=360}return{h:n,s:w,v:u}};var k=function(n,m,l){return Math.max(Math.min(n,l),m)};return{colorize:(function(){var l=function(n,m){if(typeof m.prepend!=="undefined"&&c.isFunction(m.prepend)){m.prepend(n)}};return{add:function(n,m){l(n,m);n.r=k(n.r+255*m.r,0,255);n.g=k(n.g+255*m.g,0,255);n.b=k(n.b+255*m.b,0,255)},multiply:function(n,m){l(n,m);n.r=k(n.r+n.r*m.r,0,255);n.g=k(n.g+n.g*m.g,0,255);n.b=k(n.b+n.b*m.b,0,255)},replace:function(n,m){l(n,m);if(m.r>=0){n.r=k(m.r*255,0,255)}if(m.g>=0){n.g=k(m.g*255,0,255)}if(m.b>=0){n.b=k(m.b*255,0,255)}}}})(),effect:(function(){return{inverse:function(l){l.r=255-l.r;l.g=255-l.g;l.b=255-l.b},solarize:function(n,m){var l=m.intensity(n);if(m.operator==="greater"&&l>=m.solarize*2.55||m.operator==="less"&&l<=m.solarize*2.55){e.effect.inverse(n)}}}})(),grayscale:(function(){return{average:function(l){l.r=l.g=l.b=e.intensity.average(l)},lightness:function(l){l.r=l.g=l.b=e.intensity.lightness(l)},luminosity:function(l){l.r=l.g=l.b=e.intensity.luminosity(l)},natural:function(l){l.r=l.g=l.b=e.intensity.natural(l)}}})(),hue:(function(){return{add:function(o,n){var m=j(o.r,o.g,o.b);m.h=(m.h+n.hue)%360;m.s=k(m.s+n.saturation/100,0,1);m.v=k(m.v+n.value/100,0,1);var l=i(m.h,m.s,m.v);o.r=l.r;o.g=l.g;o.b=l.b},multiply:function(o,n){var m=j(o.r,o.g,o.b);m.h=(m.h+n.hue)%360;m.s=k(m.s+m.s*n.saturation/100,0,1);m.v=k(m.v+m.v*n.value/100,0,1);var l=i(m.h,m.s,m.v);o.r=l.r;o.g=l.g;o.b=l.b},replace:function(o,n){var m=j(o.r,o.g,o.b);m.h=(m.h+n.hue)%360;if(n.saturation>=0){m.s=k(n.saturation/100,0,1)}if(n.value>=0){m.v=k(n.value/100,0,1)}var l=i(m.h,m.s,m.v);o.r=l.r;o.g=l.g;o.b=l.b}}})(),intensity:(function(){return{average:function(l){return(l.r+l.g+l.b)/3},lightness:function(l){return(Math.max(l.r,l.g,l.b)+Math.min(l.r,l.g,l.b))/2},luminosity:function(l){return(l.r*0.2126+l.g*0.7152+l.b*0.0722)},natural:function(l){return(l.r*0.299+l.g*0.587+l.b*0.114)}}})(),opacity:(function(){return{add:function(m,l){m.a=k(m.a+255*l.opacity,0,255)},multiply:function(m,l){m.a=k(m.a+m.a*l.opacity,0,255)},replace:function(m,l){m.a=k(l.opacity*255,0,255)}}})()}})();var f=function(k){var j=document.createElement("canvas");j.width=k.naturalWidth;j.height=k.naturalHeight;j.getContext("2d").drawImage(k,0,0);var i=j.getContext("2d");var l=i.getImageData(0,0,k.naturalWidth,k.naturalHeight);return{width:k.naturalWidth,height:k.naturalHeight,canvas:j,context:i,image:l,pixel:function(m,p,n){if(typeof n==="undefined"){if(m>=0&&m<this.width&&p>=0&&p<this.height){var o=4*(p*this.width+m);return{x:m,y:p,r:this.image.data[o],g:this.image.data[o+1],b:this.image.data[o+2],a:this.image.data[o+3],informations:this}}}else{if(m>=0&&m<this.width&&p>=0&&p<this.height){var o=4*(p*this.width+m);this.image.data[o]=n.r;this.image.data[o+1]=n.g;this.image.data[o+2]=n.b;this.image.data[o+3]=n.a}}}}};var g=function(m,j,l){for(var i=0;i<m.width;i++){for(var n=0;n<m.height;n++){var k=m.pixel(i,n);j(k,l);m.pixel(i,n,k)}}};var h=function(j,i){if(e.hasOwnProperty(j)){if(i.hasOwnProperty("mode")){if(e[j].hasOwnProperty(i.mode)){return e[j][i.mode]}}}return null};return{colorimazer:function(m,l,j){var k=f(m);var i=h(l,j);switch(l){case"colorize":if(typeof j.grayscale!=="undefined"&&j.grayscale!==""){j.prepend=h("grayscale",{mode:j.grayscale})}break;case"custom":i=j.fn;break;case"effect":if(typeof j.intensity!=="undefined"&&j.intensity!==""){j.intensity=h("intensity",{mode:j.intensity})}break}if(c.isFunction(i)){g(k,i,j);k.context.putImageData(k.image,0,0);m.src=k.canvas.toDataURL()}}}})();var d=(function(){return{colorize:function(e){if(c.isPlainObject(e)){if(typeof e.mode!=="undefined"){if(e.mode==="replace"){e=c.extend({},{r:-1,g:-1,b:-1},e)}}}e=c.extend({},{mode:"add",r:0,g:0,b:0},e);e.r/=100;e.g/=100;e.b/=100;return e},custom:function(e){if(c.isFunction(e)){e=c.extend({},{fn:e})}return c.extend({},e)},grayscale:function(e){return c.extend({},{mode:"average"},e)},hue:function(f){var e=0;if(c.isNumeric(f)){e=f}else{if(c.isPlainObject(f)){if(typeof f.mode!=="undefined"){if(f.mode==="replace"){f=c.extend({},{saturation:-1,value:-1},f)}}}}f=c.extend({},{mode:"add",hue:e,saturation:0,value:0},f);while(f.hue<0){f.hue+=360}return f},effect:(function(){return{inverse:function(e){return c.extend({},{mode:"inverse"},e)},solarize:function(e){return c.extend({},{mode:"solarize",intensity:"average",solarize:50,operator:"less"},e)}}})(),opacity:function(f){var e=255;if(c.isNumeric(f)){e=f}f=c.extend({},{opacity:e,mode:"replace"},f);f.opacity/=100;return f}}})();var b=function(f,e){return this.queue(function(){if(c(this).is("img")){var h=new Image();var g=c(this);h.onload=function(){this.onload=null;a.colorimazer(this,f,e);if(g.attr("src")===this.src){g.dequeue()}else{g.one("load",function(){g.dequeue()});g.attr("src",this.src)}};h.src=c(this).attr("src")}else{g.dequeue()}})};c.extend(c.fn,{save:function(){return this.queue(function(){if(c(this).is("img")&&c(this).attr("src")!==undefined){c(this).attr("data-colorimazer-save",c(this).attr("src"))}c(this).dequeue()})},restore:function(){return this.queue(function(){if(c(this).is("img")&&c(this).attr("data-colorimazer-save")!==undefined){c(this).attr("src",c(this).attr("data-colorimazer-save"))}c(this).dequeue()})},colorize:function(e){return b.call(this,"colorize",d.colorize(e))},custom:function(e){return b.call(this,"custom",d.custom(e))},grayscale:function(e){return b.call(this,"grayscale",d.grayscale(e))},hue:function(e){return b.call(this,"hue",d.hue(e))},effect:function(e){if(c.isPlainObject(e)){if(typeof e.mode!=="undefined"){if(d.effect.hasOwnProperty(e.mode)){return b.call(this,"effect",d.effect[e.mode](e))}}}},opacity:function(e){return b.call(this,"opacity",d.opacity(e))}})})(jQuery);