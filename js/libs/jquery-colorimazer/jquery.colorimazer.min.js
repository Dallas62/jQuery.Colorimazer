(function(c){var a=(function(){var e=(function(){function i(u,B,z){var l,w,y,o,x,n,m,A;if(B===0){l=w=y=z}else{u/=60;o=Math.floor(u);x=u-o;n=z*(1-B);m=z*(1-B*x);A=z*(1-B*(1-x));switch(o){case 0:l=z;w=A;y=n;break;case 1:l=m;w=z;y=n;break;case 2:l=n;w=z;y=A;break;case 3:l=n;w=m;y=z;break;case 4:l=A;w=n;y=z;break;default:l=z;w=n;y=m}}return{r:Math.round(l*255),g:Math.round(w*255),b:Math.round(y*255)}}function j(l,o,p){var m=Math.min(l,o,p);var q=Math.max(l,o,p);var u=q/255;var w=0;var n=-1;var t=q-m;if(q!==0){w=t/q;if(l===q){n=(o-p)/t}else{if(o===q){n=2+(p-l)/t}else{n=4+(l-o)/t}}}n*=60;if(n<0){n+=360}return{h:n,s:w,v:u}}function k(n,m,l){return Math.max(Math.min(n,l),m)}return{colorize:(function(){var l=function(n,m){if(typeof m.prepend!=="undefined"&&c.isFunction(m.prepend)){m.prepend(n)}};return{add:function(n,o,m){l(n,m);n.r=k(n.r+255*m.r,0,255);n.g=k(n.g+255*m.g,0,255);n.b=k(n.b+255*m.b,0,255)},multiply:function(n,o,m){l(n,m);n.r=k(n.r+n.r*m.r,0,255);n.g=k(n.g+n.g*m.g,0,255);n.b=k(n.b+n.b*m.b,0,255)},replace:function(n,o,m){l(n,m);if(m.r>=0){n.r=k(m.r*255,0,255)}if(m.g>=0){n.g=k(m.g*255,0,255)}if(m.b>=0){n.b=k(m.b*255,0,255)}}}})(),effect:(function(){return{blur:function(m,u,v){var o=0;var p=null;var l=0;var n=0;var s=0;for(var q=-v.radius;q<=v.radius;q+=1){for(var t=-v.radius;t<=v.radius;t+=1){if(Math.sqrt(t*t+q*q)<=v.radius){p=u.pixel(m.x+t,m.y+q);if(p!==null){o++;l+=p.r;n+=p.g;s+=p.b}}}}if(o!==0){m.r=l/o;m.g=n/o;m.b=s/o}},inverse:function(l){l.r=255-l.r;l.g=255-l.g;l.b=255-l.b},solarize:function(n,o,m){var l=m.intensity(n);if(m.operator==="greater"&&l>=m.solarize||m.operator==="less"&&l<=m.solarize){e.effect.inverse(n)}}}})(),grayscale:(function(){return{average:function(l){l.r=l.g=l.b=e.intensity.average(l)},lightness:function(l){l.r=l.g=l.b=e.intensity.lightness(l)},luminosity:function(l){l.r=l.g=l.b=e.intensity.luminosity(l)},natural:function(l){l.r=l.g=l.b=e.intensity.natural(l)},red:function(l){l.r=l.g=l.b=e.intensity.red(l)},green:function(l){l.r=l.g=l.b=e.intensity.green(l)},blue:function(l){l.r=l.g=l.b=e.intensity.blue(l)}}})(),hue:(function(){return{add:function(o,p,n){var m=j(o.r,o.g,o.b);m.h=(m.h+n.hue)%360;m.s=k(m.s+n.saturation,0,1);m.v=k(m.v+n.value,0,1);var l=i(m.h,m.s,m.v);o.r=l.r;o.g=l.g;o.b=l.b},multiply:function(o,p,n){var m=j(o.r,o.g,o.b);m.h=(m.h+n.hue)%360;m.s=k(m.s+m.s*n.saturation,0,1);m.v=k(m.v+m.v*n.value,0,1);var l=i(m.h,m.s,m.v);o.r=l.r;o.g=l.g;o.b=l.b},replace:function(o,p,n){var m=j(o.r,o.g,o.b);m.h=(m.h+n.hue)%360;if(n.saturation>=0){m.s=k(n.saturation,0,1)}if(n.value>=0){m.v=k(n.value,0,1)}var l=i(m.h,m.s,m.v);o.r=l.r;o.g=l.g;o.b=l.b}}})(),intensity:(function(){return{average:function(l){return(l.r+l.g+l.b)/3},lightness:function(l){return(Math.max(l.r,l.g,l.b)+Math.min(l.r,l.g,l.b))/2},luminosity:function(l){return(l.r*0.2126+l.g*0.7152+l.b*0.0722)},natural:function(l){return(l.r*0.299+l.g*0.587+l.b*0.114)},red:function(l){return l.r},green:function(l){return l.g},blue:function(l){return l.b}}})(),opacity:(function(){return{add:function(m,n,l){m.a=k(m.a+255*l.opacity,0,255)},multiply:function(m,n,l){m.a=k(m.a+m.a*l.opacity,0,255)},replace:function(m,n,l){m.a=k(l.opacity*255,0,255)}}})()}})();function f(k){var j=document.createElement("canvas");j.width=k.naturalWidth;j.height=k.naturalHeight;j.getContext("2d").drawImage(k,0,0);var i=j.getContext("2d");var l=i.getImageData(0,0,k.naturalWidth,k.naturalHeight);return{width:k.naturalWidth,height:k.naturalHeight,canvas:j,context:i,image:l,data:l.data,pixel:function(m,p,n){if(m>=0&&p>=0&&m<this.width&&p<this.height){var o=4*(p*this.width+m);if(typeof n!=="undefined"){this.data[o]=n.r;this.data[o+1]=n.g;this.data[o+2]=n.b;this.data[o+3]=n.a}else{return{r:this.data[o],g:this.data[o+1],b:this.data[o+2],a:this.data[o+3],x:m,y:p}}}return null}}}function g(m,j,l){for(var i=0;i<m.width;i+=1){for(var n=0;n<m.height;n+=1){var k=m.pixel(i,n);j(k,m,l);m.pixel(i,n,k)}}}function h(j,i){if(e.hasOwnProperty(j)&&i.hasOwnProperty("mode")){if(e[j].hasOwnProperty(i.mode)){return e[j][i.mode]}}return null}return{colorimazer:function(m,l,j){var k=f(m);var i=h(l,j);switch(l){case"colorize":if(typeof j.grayscale!=="undefined"){j.prepend=h("grayscale",{mode:j.grayscale})}break;case"custom":i=j.fn;break;case"effect":if(typeof j.intensity!=="undefined"){j.intensity=h("intensity",{mode:j.intensity})}break}if(typeof i==="function"){g(k,i,j);k.context.putImageData(k.image,0,0);m.src=k.canvas.toDataURL()}}}})();var d=(function(){return{colorize:function(e){if(c.isPlainObject(e)){if(typeof e.mode!=="undefined"){if(e.mode==="replace"){e=c.extend({},{r:-1,g:-1,b:-1},e)}}}e=c.extend({},{mode:"add",r:0,g:0,b:0},e);e.r/=100;e.g/=100;e.b/=100;return e},custom:function(e){if(c.isFunction(e)){e=c.extend({},{fn:e})}return c.extend({},e)},grayscale:function(e){return c.extend({},{mode:"average"},e)},hue:function(f){var e=0;if(c.isNumeric(f)){e=f}else{if(c.isPlainObject(f)){if(typeof f.mode!=="undefined"){if(f.mode==="replace"){f=c.extend({},{saturation:-1,value:-1},f)}}}}f=c.extend({},{mode:"add",hue:e,saturation:0,value:0},f);if(f.hue<0){f.hue+=360}f.saturation/=100;f.value/=100;return f},effect:(function(){return{blur:function(e){return c.extend({},{mode:"blur",radius:3},e)},inverse:function(e){return c.extend({},{mode:"inverse"},e)},solarize:function(e){e=c.extend({},{mode:"solarize",intensity:"average",solarize:50,operator:"less"},e);e.solarize*=2.55;return e}}})(),opacity:function(f){var e=255;if(c.isNumeric(f)){e=f}f=c.extend({},{opacity:e,mode:"replace"},f);f.opacity/=100;return f}}})();var b=function(f,e){return this.queue(function(){if(c(this).is("img")){var h=new Image();var g=c(this);h.onload=function(){this.onload=null;a.colorimazer(this,f,e);if(g.attr("src")===this.src){g.dequeue()}else{g.one("load",function(){g.dequeue()});g.attr("src",this.src)}};h.src=c(this).attr("src")}else{g.dequeue()}})};c.extend(c.fn,{save:function(){return this.queue(function(){if(c(this).is("img")&&c(this).attr("src")!==undefined){c(this).attr("data-colorimazer-save",c(this).attr("src"))}c(this).dequeue()})},restore:function(){return this.queue(function(){if(c(this).is("img")&&c(this).attr("data-colorimazer-save")!==undefined){c(this).attr("src",c(this).attr("data-colorimazer-save"))}c(this).dequeue()})},colorize:function(e){return b.call(this,"colorize",d.colorize(e))},custom:function(e){return b.call(this,"custom",d.custom(e))},grayscale:function(e){return b.call(this,"grayscale",d.grayscale(e))},hue:function(e){return b.call(this,"hue",d.hue(e))},effect:function(e){if(c.isPlainObject(e)){if(typeof e.mode!=="undefined"){if(d.effect.hasOwnProperty(e.mode)){return b.call(this,"effect",d.effect[e.mode](e))}}}},opacity:function(e){return b.call(this,"opacity",d.opacity(e))}})})(jQuery);